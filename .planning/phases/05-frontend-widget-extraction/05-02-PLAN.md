---
phase: 05-frontend-widget-extraction
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - app/lib/features/export/presentation/export_screen.dart
  - app/lib/features/export/presentation/widgets/export_option_card.dart
  - app/lib/features/export/presentation/widgets/export_history_tile.dart
  - app/lib/features/export/presentation/widgets/export_dialogs.dart
  - app/lib/features/export/presentation/widgets/widgets.dart
  - app/lib/features/activities/presentation/activity_detail_screen.dart
  - app/lib/features/activities/presentation/widgets/activity_detail_content.dart
  - app/lib/features/activities/presentation/widgets/widgets.dart
autonomous: true

must_haves:
  truths:
    - "export_screen.dart is under 350 LOC after extraction"
    - "activity_detail_screen.dart is under 350 LOC after extraction"
    - "All export functionality works identically (export options, dialog, preview, history)"
    - "All activity detail functionality works identically (header, response, admin actions)"
    - "flutter analyze shows no new errors"
  artifacts:
    - path: "app/lib/features/export/presentation/widgets/export_option_card.dart"
      provides: "ExportOptionCard widget (was _ExportOptionCard, now public)"
    - path: "app/lib/features/export/presentation/widgets/export_history_tile.dart"
      provides: "ExportHistoryTile widget (was _ExportHistoryTile, now public)"
    - path: "app/lib/features/export/presentation/widgets/export_dialogs.dart"
      provides: "ExportDialog and ExportPreviewDialog (were private, now public)"
    - path: "app/lib/features/activities/presentation/widgets/activity_detail_content.dart"
      provides: "ActivityDetailContent widget (was _ActivityDetailContent, now public)"
  key_links:
    - from: "app/lib/core/router.dart"
      to: "export_screen.dart"
      via: "import"
      pattern: "import.*export_screen"
    - from: "app/lib/core/router.dart"
      to: "activity_detail_screen.dart"
      via: "import"
      pattern: "import.*activity_detail_screen"
    - from: "app/lib/features/activities/presentation/widgets/widgets.dart"
      to: "activity_detail_content.dart"
      via: "barrel export"
      pattern: "export.*activity_detail_content"
---

<objective>
Split export_screen.dart (470 LOC) and activity_detail_screen.dart (456 LOC) into focused widget files under 350 LOC each.

Purpose: Reduce file size for maintainability. These two files are in independent features (export, activities) with no shared files.
Output: 4 new widget files, 2 updated barrel exports, 2 reduced source files.
</objective>

<execution_context>
@/Users/karsten/.claude/get-shit-done/workflows/execute-plan.md
@/Users/karsten/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-frontend-widget-extraction/05-RESEARCH.md
@app/lib/features/export/presentation/export_screen.dart
@app/lib/features/activities/presentation/activity_detail_screen.dart
@app/lib/features/activities/presentation/widgets/widgets.dart
@app/lib/core/router.dart
</context>

<tasks>

<task type="auto">
  <name>Task 1: Split export_screen.dart into screen + 3 widget files</name>
  <files>
    app/lib/features/export/presentation/export_screen.dart
    app/lib/features/export/presentation/widgets/export_option_card.dart
    app/lib/features/export/presentation/widgets/export_history_tile.dart
    app/lib/features/export/presentation/widgets/export_dialogs.dart
    app/lib/features/export/presentation/widgets/widgets.dart
  </files>
  <action>
    Split export_screen.dart (470 LOC, 1 screen + 4 private widgets) into 4 files:

    First, create `app/lib/features/export/presentation/widgets/` directory (it does not exist yet).

    1. **export_option_card.dart** (~55 LOC): Extract `_ExportOptionCard` (lines 221-274) as public `ExportOptionCard`. Needs imports: flutter/material, export_log model (for ExportType).

    2. **export_history_tile.dart** (~40 LOC): Extract `_ExportHistoryTile` (lines 276-316) as public `ExportHistoryTile`. Needs imports: flutter/material, intl, export_log model.

    3. **export_dialogs.dart** (~150 LOC): Extract `_ExportDialog` + `_ExportDialogState` (lines 318-381) as public `ExportDialog`, and `_ExportPreviewDialog` (lines 383-470) as public `ExportPreviewDialog`. Needs imports: flutter/material, export_log model (for ExportType, ExportFormat, ExportData).

    4. **export_screen.dart** (~220 LOC): Remains with `ExportScreen` + `_ExportScreenState` (lines 1-219). Update references from `_ExportOptionCard` to `ExportOptionCard`, `_ExportHistoryTile` to `ExportHistoryTile`, `_ExportDialog` to `ExportDialog`, `_ExportPreviewDialog` to `ExportPreviewDialog`.

    Create **widgets/widgets.dart** barrel file:
    ```dart
    export 'export_dialogs.dart';
    export 'export_history_tile.dart';
    export 'export_option_card.dart';
    ```

    Update export_screen.dart to `import 'widgets/widgets.dart';`

    Note: export_screen.dart will be ~220 LOC which is under 350. The _ExportScreenState contains tightly coupled _performExport, _shareCsv, _showExportPreview methods that reference each other and share state (widget.teamId, notifier). Keeping them together is the right call.
  </action>
  <verify>
    Run: `cd "/Users/karsten/NextCore/Core - Idrett/app" && flutter analyze lib/features/export/`
    Expected: No new errors or warnings.
    Run: `wc -l lib/features/export/presentation/export_screen.dart lib/features/export/presentation/widgets/export_option_card.dart lib/features/export/presentation/widgets/export_history_tile.dart lib/features/export/presentation/widgets/export_dialogs.dart`
    Expected: Each file under 350 LOC. export_screen.dart reduced from 470 to ~220.
  </verify>
  <done>export_screen.dart reduced to ~220 LOC. 3 new widget files created in new widgets/ directory with barrel export. All private widgets made public. flutter analyze shows no new errors.</done>
</task>

<task type="auto">
  <name>Task 2: Split activity_detail_screen.dart by extracting content widget</name>
  <files>
    app/lib/features/activities/presentation/activity_detail_screen.dart
    app/lib/features/activities/presentation/widgets/activity_detail_content.dart
    app/lib/features/activities/presentation/widgets/widgets.dart
  </files>
  <action>
    Split activity_detail_screen.dart (456 LOC, 1 screen + 1 large content widget) into 2 files:

    1. **activity_detail_content.dart** (~275 LOC): Extract `_ActivityDetailContent` + `_ActivityDetailContentState` (lines 185-456) as public `ActivityDetailContent`. This includes the build method, `_canAwardAttendancePoints`, `_awardAttendancePoints`, `_canManageMiniActivities`, `_respond` methods. Needs imports: flutter/material, flutter_riverpod, intl, activity model, team model, user model, activity_provider, activity_info_widgets, activity_response_widgets, absence_button, mini_activities_section, admin_actions_section.

    2. **activity_detail_screen.dart** (~185 LOC): Remains with `ActivityDetailScreen` (lines 1-183). Update references from `_ActivityDetailContent` to `ActivityDetailContent`. Add `import 'widgets/activity_detail_content.dart';` or use barrel.

    Update existing **widgets/widgets.dart** barrel file to add:
    ```dart
    export 'activity_detail_content.dart';
    ```

    The widgets.dart barrel file already exists at `app/lib/features/activities/presentation/widgets/widgets.dart`. Just add the new export line.

    activity_detail_screen.dart currently imports individual widget files (absence_button.dart, activity_info_widgets.dart, etc.). After extraction, the screen only needs to import activity_detail_content.dart (which itself imports the sub-widgets). Remove the now-unused widget imports from activity_detail_screen.dart.
  </action>
  <verify>
    Run: `cd "/Users/karsten/NextCore/Core - Idrett/app" && flutter analyze lib/features/activities/`
    Expected: No new errors or warnings.
    Run: `wc -l lib/features/activities/presentation/activity_detail_screen.dart lib/features/activities/presentation/widgets/activity_detail_content.dart`
    Expected: activity_detail_screen.dart ~185 LOC, activity_detail_content.dart ~275 LOC. Both under 350.
    Run: `cd "/Users/karsten/NextCore/Core - Idrett/app" && flutter test test/features/activities/`
    Expected: Existing activity tests pass (may have pre-existing failures from 8 known error state tests).
  </verify>
  <done>activity_detail_screen.dart reduced from 456 to ~185 LOC. ActivityDetailContent extracted to own file at ~275 LOC. Barrel export updated. flutter analyze passes. Existing activity tests unaffected.</done>
</task>

</tasks>

<verification>
1. `cd "/Users/karsten/NextCore/Core - Idrett/app" && flutter analyze lib/features/export/ lib/features/activities/` -- zero new errors
2. All original files under 350 LOC or converted to barrel
3. No extracted files exceed 350 LOC
4. Existing imports from router.dart still resolve
5. Activity detail tests pass: `flutter test test/features/activities/`
</verification>

<success_criteria>
- export_screen.dart reduced from 470 to ~220 LOC
- activity_detail_screen.dart reduced from 456 to ~185 LOC
- 4 new widget files created, all under 350 LOC
- flutter analyze passes with no new errors on export and activities features
</success_criteria>

<output>
After completion, create `.planning/phases/05-frontend-widget-extraction/05-02-SUMMARY.md`
</output>
