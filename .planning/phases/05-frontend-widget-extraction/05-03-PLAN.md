---
phase: 05-frontend-widget-extraction
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - app/lib/features/mini_activities/presentation/widgets/mini_activity_detail_content.dart
  - app/lib/features/mini_activities/presentation/widgets/mini_activity_dialogs.dart
  - app/lib/features/mini_activities/presentation/widgets/result_badge.dart
  - app/lib/features/mini_activities/presentation/widgets/stats_widgets.dart
  - app/lib/features/mini_activities/presentation/widgets/player_stats_card.dart
  - app/lib/features/mini_activities/presentation/widgets/head_to_head_widgets.dart
  - app/lib/features/mini_activities/presentation/widgets/stats_helpers.dart
  - app/lib/features/mini_activities/presentation/widgets/widgets.dart
autonomous: true

must_haves:
  truths:
    - "mini_activity_detail_content.dart is under 350 LOC after extraction"
    - "stats_widgets.dart is under 350 LOC or converted to barrel after extraction"
    - "All mini-activity detail functionality works identically (header, teams, division, scores, results)"
    - "All stats widget functionality works identically (player cards, head-to-head, podium badges)"
    - "flutter analyze shows no new errors"
  artifacts:
    - path: "app/lib/features/mini_activities/presentation/widgets/mini_activity_dialogs.dart"
      provides: "Dialog helper methods extracted from MiniActivityDetailContentState"
    - path: "app/lib/features/mini_activities/presentation/widgets/result_badge.dart"
      provides: "ResultBadge widget"
    - path: "app/lib/features/mini_activities/presentation/widgets/player_stats_card.dart"
      provides: "PlayerStatsCard and CompactStatsCard widgets"
    - path: "app/lib/features/mini_activities/presentation/widgets/head_to_head_widgets.dart"
      provides: "HeadToHeadCard and HeadToHeadScore widgets"
    - path: "app/lib/features/mini_activities/presentation/widgets/stats_helpers.dart"
      provides: "StatsItem and PodiumBadge utility widgets"
  key_links:
    - from: "app/lib/features/mini_activities/presentation/widgets/mini_activity_team_card.dart"
      to: "mini_activity_detail_content.dart"
      via: "import for ResultBadge"
      pattern: "import.*mini_activity_detail_content|import.*result_badge"
    - from: "app/lib/features/mini_activities/presentation/widgets/team_stats_tab.dart"
      to: "stats_widgets.dart"
      via: "import"
      pattern: "import.*stats_widgets"
    - from: "app/lib/features/mini_activities/presentation/screens/player_stats_screen.dart"
      to: "stats_widgets.dart"
      via: "import"
      pattern: "import.*stats_widgets"
---

<objective>
Split mini_activity_detail_content.dart (436 LOC) and stats_widgets.dart (429 LOC) into focused widget files under 350 LOC each.

Purpose: Reduce file size for maintainability. Both files are in the same feature (mini_activities) and same widgets folder, but contain independent widgets with no cross-references between the two.
Output: 5 new widget files, 1 updated barrel export, 2 reduced source files.
</objective>

<execution_context>
@/Users/karsten/.claude/get-shit-done/workflows/execute-plan.md
@/Users/karsten/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-frontend-widget-extraction/05-RESEARCH.md
@app/lib/features/mini_activities/presentation/widgets/mini_activity_detail_content.dart
@app/lib/features/mini_activities/presentation/widgets/stats_widgets.dart
@app/lib/features/mini_activities/presentation/widgets/widgets.dart
@app/lib/features/mini_activities/presentation/widgets/mini_activity_team_card.dart
@app/lib/features/mini_activities/presentation/widgets/team_stats_tab.dart
@app/lib/features/mini_activities/presentation/screens/player_stats_screen.dart
</context>

<tasks>

<task type="auto">
  <name>Task 1: Split mini_activity_detail_content.dart by extracting dialogs and ResultBadge</name>
  <files>
    app/lib/features/mini_activities/presentation/widgets/mini_activity_detail_content.dart
    app/lib/features/mini_activities/presentation/widgets/mini_activity_dialogs.dart
    app/lib/features/mini_activities/presentation/widgets/result_badge.dart
    app/lib/features/mini_activities/presentation/widgets/widgets.dart
  </files>
  <action>
    Split mini_activity_detail_content.dart (436 LOC) into 3 files:

    1. **result_badge.dart** (~35 LOC): Extract `ResultBadge` class (lines 402-436). This is an independent public StatelessWidget. Needs imports: flutter/material.

    2. **mini_activity_dialogs.dart** (~130 LOC): Extract all dialog/sheet helper methods from `MiniActivityDetailContentState` as standalone functions. Extract: `showEditWarningDialog`, `showMiniActivityDivisionDialog` (renamed from `_showDivisionDialog`), `showMiniActivityScoreDialog` (renamed from `_showScoreDialog`), `showSetWinnerDialog` (renamed from `_showSetWinnerDialog`), `showClearResultDialog` (renamed from `_showClearResultDialog`), `showAddTeamDialog` (renamed from `_showAddTeamDialog`).

       Each function takes the required parameters explicitly (BuildContext, WidgetRef, miniActivityId, instanceId, teamId, etc.) instead of relying on `widget.*` state. The functions need imports for: flutter/material, flutter_riverpod, mini_activity model, mini_activity_provider, mini_activity_sheets (for TeamDivisionSheet, RecordScoresSheet, SetWinnerDialog).

       This pattern is appropriate because these are all stateless dialog/sheet launchers that just call showDialog/showModalBottomSheet with parameters.

    3. **mini_activity_detail_content.dart** (~270 LOC): Remains with `MiniActivityDetailContent` + `MiniActivityDetailContentState`. Remove the extracted dialog methods and ResultBadge. Replace dialog method calls with calls to the new functions from mini_activity_dialogs.dart, passing required parameters explicitly. For example:
       - `_showEditWarningDialog(context)` becomes `showEditWarningDialog(context, onConfirm: () => setState(() => _isEditMode = true))`
       - `_showDivisionDialog(context, ref)` becomes `showMiniActivityDivisionDialog(context, miniActivityId: widget.miniActivity.id, instanceId: widget.instanceId, teamId: widget.teamId)`

       Add `import 'mini_activity_dialogs.dart';` and `import 'result_badge.dart';` (though ResultBadge is not directly used in this file -- it was just co-located).

    Update **widgets.dart** barrel to add:
    ```dart
    export 'mini_activity_dialogs.dart';
    export 'result_badge.dart';
    ```

    IMPORTANT: mini_activity_team_card.dart imports mini_activity_detail_content.dart to use `ResultBadge`. After extraction, update that import to use `result_badge.dart` instead (or it will still work via barrel, but direct import is cleaner). Check the import and update if it references `mini_activity_detail_content.dart` specifically for ResultBadge.
  </action>
  <verify>
    Run: `cd "/Users/karsten/NextCore/Core - Idrett/app" && flutter analyze lib/features/mini_activities/`
    Expected: No new errors or warnings.
    Run: `wc -l lib/features/mini_activities/presentation/widgets/mini_activity_detail_content.dart lib/features/mini_activities/presentation/widgets/mini_activity_dialogs.dart lib/features/mini_activities/presentation/widgets/result_badge.dart`
    Expected: mini_activity_detail_content.dart under 350 LOC.
  </verify>
  <done>mini_activity_detail_content.dart reduced from 436 to ~270 LOC. Dialog helpers extracted to mini_activity_dialogs.dart. ResultBadge extracted to own file. mini_activity_team_card.dart import updated. flutter analyze passes.</done>
</task>

<task type="auto">
  <name>Task 2: Split stats_widgets.dart into 3 focused widget files</name>
  <files>
    app/lib/features/mini_activities/presentation/widgets/stats_widgets.dart
    app/lib/features/mini_activities/presentation/widgets/player_stats_card.dart
    app/lib/features/mini_activities/presentation/widgets/head_to_head_widgets.dart
    app/lib/features/mini_activities/presentation/widgets/stats_helpers.dart
    app/lib/features/mini_activities/presentation/widgets/widgets.dart
  </files>
  <action>
    Split stats_widgets.dart (429 LOC, 6 public widgets) into 3 files:

    1. **player_stats_card.dart** (~215 LOC): Extract `PlayerStatsCard` (lines 6-146) and `CompactStatsCard` (lines 148-215). PlayerStatsCard delegates to CompactStatsCard when isCompact=true, so they must stay together. Both reference `StatsItem` and `PodiumBadge` -- import those from stats_helpers.dart. Needs imports: flutter/material, cached_network_image, mini_activity_statistics model, stats_helpers.dart.

    2. **head_to_head_widgets.dart** (~140 LOC): Extract `HeadToHeadCard` (lines 290-350) and `HeadToHeadScore` (lines 352-429). HeadToHeadCard uses HeadToHeadScore, so they stay together. Needs imports: flutter/material, mini_activity_statistics model (for HeadToHeadStats).

    3. **stats_helpers.dart** (~75 LOC): Extract `StatsItem` (lines 218-250) and `PodiumBadge` (lines 252-288). These are small utility widgets used by PlayerStatsCard. Needs imports: flutter/material.

    After extraction, **stats_widgets.dart becomes a barrel file** re-exporting all 3 new files:
    ```dart
    export 'head_to_head_widgets.dart';
    export 'player_stats_card.dart';
    export 'stats_helpers.dart';
    ```

    This preserves existing imports: team_stats_tab.dart imports stats_widgets.dart directly, and player_stats_screen.dart imports ../widgets/stats_widgets.dart. Both continue working via the barrel.

    Also update **widgets.dart** barrel -- it already exports stats_widgets.dart, which will now re-export the 3 new files. No change needed to widgets.dart unless we want to flatten the export chain (optional, not required).
  </action>
  <verify>
    Run: `cd "/Users/karsten/NextCore/Core - Idrett/app" && flutter analyze lib/features/mini_activities/`
    Expected: No new errors or warnings.
    Run: `wc -l lib/features/mini_activities/presentation/widgets/player_stats_card.dart lib/features/mini_activities/presentation/widgets/head_to_head_widgets.dart lib/features/mini_activities/presentation/widgets/stats_helpers.dart`
    Expected: Each file under 350 LOC.
  </verify>
  <done>stats_widgets.dart converted to barrel file. 3 focused widget files created, each under 350 LOC. Existing imports via stats_widgets.dart continue working. flutter analyze passes.</done>
</task>

</tasks>

<verification>
1. `cd "/Users/karsten/NextCore/Core - Idrett/app" && flutter analyze lib/features/mini_activities/` -- zero new errors
2. All original files under 350 LOC or converted to barrel
3. No extracted files exceed 350 LOC
4. Existing imports from team_stats_tab.dart, player_stats_screen.dart, mini_activity_team_card.dart still resolve
</verification>

<success_criteria>
- mini_activity_detail_content.dart reduced from 436 to ~270 LOC
- stats_widgets.dart converted to barrel re-exporting 3 new files
- 5 new widget files created, all under 350 LOC
- flutter analyze passes with no new errors on mini_activities feature
</success_criteria>

<output>
After completion, create `.planning/phases/05-frontend-widget-extraction/05-03-SUMMARY.md`
</output>
