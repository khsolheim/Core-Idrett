---
phase: 05-frontend-widget-extraction
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - app/lib/features/teams/presentation/widgets/edit_team_members_tab.dart
  - app/lib/features/teams/presentation/widgets/member_tile.dart
  - app/lib/features/teams/presentation/widgets/member_action_dialogs.dart
  - app/lib/features/teams/presentation/widgets/dashboard_info_widgets.dart
  - app/lib/features/teams/presentation/widgets/leaderboard_widget.dart
  - app/lib/features/teams/presentation/widgets/messages_widget.dart
  - app/lib/features/teams/presentation/widgets/fines_widget.dart
  - app/lib/features/teams/presentation/widgets/quick_links_widget.dart
  - app/lib/features/teams/presentation/widgets/widgets.dart
autonomous: true

must_haves:
  truths:
    - "edit_team_members_tab.dart is under 350 LOC after extraction"
    - "dashboard_info_widgets.dart is under 350 LOC or converted to barrel after extraction"
    - "All team member management functionality works identically (permissions, injury, deactivate, remove)"
    - "All dashboard info widgets work identically (leaderboard, messages, fines, quick links)"
    - "flutter analyze shows no new errors"
  artifacts:
    - path: "app/lib/features/teams/presentation/widgets/member_tile.dart"
      provides: "MemberTile widget (was _MemberTile, now public)"
    - path: "app/lib/features/teams/presentation/widgets/member_action_dialogs.dart"
      provides: "Dialog helper functions for member actions"
    - path: "app/lib/features/teams/presentation/widgets/leaderboard_widget.dart"
      provides: "LeaderboardWidget, DashboardLeaderboardRow, DashboardRankBadge"
    - path: "app/lib/features/teams/presentation/widgets/messages_widget.dart"
      provides: "MessagesWidget"
    - path: "app/lib/features/teams/presentation/widgets/fines_widget.dart"
      provides: "FinesWidget"
    - path: "app/lib/features/teams/presentation/widgets/quick_links_widget.dart"
      provides: "QuickLinksWidget and QuickLinkChip"
  key_links:
    - from: "app/lib/features/teams/presentation/edit_team_screen.dart"
      to: "edit_team_members_tab.dart"
      via: "import"
      pattern: "import.*edit_team_members_tab"
    - from: "app/lib/features/teams/presentation/widgets/team_dashboard_body.dart"
      to: "dashboard_info_widgets.dart"
      via: "import"
      pattern: "import.*dashboard_info_widgets"
---

<objective>
Split edit_team_members_tab.dart (423 LOC) and dashboard_info_widgets.dart (420 LOC) into focused widget files under 350 LOC each.

Purpose: Reduce file size for maintainability. Both files are in the same feature (teams) and same widgets folder, but contain independent widgets.
Output: 6 new widget files, 1 updated barrel export, 2 reduced source files.
</objective>

<execution_context>
@/Users/karsten/.claude/get-shit-done/workflows/execute-plan.md
@/Users/karsten/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-frontend-widget-extraction/05-RESEARCH.md
@app/lib/features/teams/presentation/widgets/edit_team_members_tab.dart
@app/lib/features/teams/presentation/widgets/dashboard_info_widgets.dart
@app/lib/features/teams/presentation/widgets/widgets.dart
@app/lib/features/teams/presentation/edit_team_screen.dart
@app/lib/features/teams/presentation/widgets/team_dashboard_body.dart
</context>

<tasks>

<task type="auto">
  <name>Task 1: Split edit_team_members_tab.dart by extracting MemberTile and dialog helpers</name>
  <files>
    app/lib/features/teams/presentation/widgets/edit_team_members_tab.dart
    app/lib/features/teams/presentation/widgets/member_tile.dart
    app/lib/features/teams/presentation/widgets/member_action_dialogs.dart
    app/lib/features/teams/presentation/widgets/widgets.dart
  </files>
  <action>
    Split edit_team_members_tab.dart (423 LOC, 1 tab widget + 1 tile widget with many methods) into 3 files:

    The challenge: `_MemberTile` is 333 LOC (lines 91-423), which alone is borderline. The dialog/action methods (_deactivateMember, _reactivateMember, _removeMember) account for ~100 LOC and are pure dialog-launch-then-call-notifier patterns. Extract those as standalone functions.

    1. **member_action_dialogs.dart** (~100 LOC): Extract these as standalone functions:
       - `showDeactivateMemberDialog(BuildContext context, WidgetRef ref, String teamId, TeamMember member)` -- shows AlertDialog confirming deactivation, calls teamNotifierProvider.notifier.deactivateMember on confirm
       - `showRemoveMemberDialog(BuildContext context, WidgetRef ref, String teamId, TeamMember member)` -- shows AlertDialog confirming permanent removal, calls teamNotifierProvider.notifier.removeMember on confirm
       - (Note: _reactivateMember does not show a dialog, it directly calls the notifier. Keep it as a method in MemberTile.)

       Needs imports: flutter/material, flutter_riverpod, team model (for TeamMember), team_provider.

    2. **member_tile.dart** (~235 LOC): Extract `_MemberTile` (lines 91-423 minus extracted dialogs) as public `MemberTile`. Keep `_updateMemberPermissions`, `_setMemberInjuredStatus`, `_reactivateMember` as methods within MemberTile (they don't show confirmation dialogs, they just call the notifier). Replace `_deactivateMember` and `_removeMember` calls with `showDeactivateMemberDialog(...)` and `showRemoveMemberDialog(...)`. Needs imports: flutter/material, flutter_riverpod, cached_network_image, team model (TeamMember, TrainerType), team_provider, member_action_dialogs.dart.

    3. **edit_team_members_tab.dart** (~90 LOC): Remains with `EditTeamMembersTab` + `_EditTeamMembersTabState` (lines 1-89). Update `_MemberTile` reference to `MemberTile`. Add `import 'member_tile.dart';`.

    Update **widgets.dart** barrel to add:
    ```dart
    export 'member_action_dialogs.dart';
    export 'member_tile.dart';
    ```
  </action>
  <verify>
    Run: `cd "/Users/karsten/NextCore/Core - Idrett/app" && flutter analyze lib/features/teams/`
    Expected: No new errors or warnings.
    Run: `wc -l lib/features/teams/presentation/widgets/edit_team_members_tab.dart lib/features/teams/presentation/widgets/member_tile.dart lib/features/teams/presentation/widgets/member_action_dialogs.dart`
    Expected: All files under 350 LOC. edit_team_members_tab.dart reduced from 423 to ~90.
    Run: `cd "/Users/karsten/NextCore/Core - Idrett/app" && flutter test test/features/teams/`
    Expected: Existing team tests pass (may have pre-existing failures from 8 known error state tests).
  </verify>
  <done>edit_team_members_tab.dart reduced from 423 to ~90 LOC. MemberTile extracted (~235 LOC). Dialog helpers extracted (~100 LOC). All under 350 LOC. flutter analyze passes. Team tests unaffected.</done>
</task>

<task type="auto">
  <name>Task 2: Split dashboard_info_widgets.dart into 4 focused widget files</name>
  <files>
    app/lib/features/teams/presentation/widgets/dashboard_info_widgets.dart
    app/lib/features/teams/presentation/widgets/leaderboard_widget.dart
    app/lib/features/teams/presentation/widgets/messages_widget.dart
    app/lib/features/teams/presentation/widgets/fines_widget.dart
    app/lib/features/teams/presentation/widgets/quick_links_widget.dart
    app/lib/features/teams/presentation/widgets/widgets.dart
  </files>
  <action>
    Split dashboard_info_widgets.dart (420 LOC, 7 public widgets) into 4 files:

    1. **leaderboard_widget.dart** (~165 LOC): Extract `LeaderboardWidget` (lines 7-63), `DashboardLeaderboardRow` (lines 66-115), and `DashboardRankBadge` (lines 118-166). These three are tightly coupled (LeaderboardWidget uses DashboardLeaderboardRow which uses DashboardRankBadge). Needs imports: flutter/material, go_router, cached_network_image, dashboard_provider (for LeaderboardEntry).

    2. **messages_widget.dart** (~85 LOC): Extract `MessagesWidget` (lines 169-253). Independent widget. Needs imports: flutter/material, go_router.

    3. **fines_widget.dart** (~85 LOC): Extract `FinesWidget` (lines 256-338). Independent widget. Needs imports: flutter/material, go_router, dashboard_provider (for FinesSummary).

    4. **quick_links_widget.dart** (~80 LOC): Extract `QuickLinksWidget` (lines 341-394) and `QuickLinkChip` (lines 397-420). QuickLinksWidget uses QuickLinkChip, so they stay together. Needs imports: flutter/material, go_router.

    After extraction, **dashboard_info_widgets.dart becomes a barrel file** re-exporting all 4 new files:
    ```dart
    export 'fines_widget.dart';
    export 'leaderboard_widget.dart';
    export 'messages_widget.dart';
    export 'quick_links_widget.dart';
    ```

    This preserves the existing import in team_dashboard_body.dart which imports `dashboard_info_widgets.dart` directly.

    The **widgets.dart** barrel already exports `dashboard_info_widgets.dart`, which will now re-export the 4 new files. No change needed to widgets.dart.
  </action>
  <verify>
    Run: `cd "/Users/karsten/NextCore/Core - Idrett/app" && flutter analyze lib/features/teams/`
    Expected: No new errors or warnings.
    Run: `wc -l lib/features/teams/presentation/widgets/leaderboard_widget.dart lib/features/teams/presentation/widgets/messages_widget.dart lib/features/teams/presentation/widgets/fines_widget.dart lib/features/teams/presentation/widgets/quick_links_widget.dart`
    Expected: Each file under 350 LOC.
    Run: `cd "/Users/karsten/NextCore/Core - Idrett/app" && flutter test test/features/teams/`
    Expected: Existing team tests pass.
  </verify>
  <done>dashboard_info_widgets.dart converted to barrel file. 4 focused widget files created, each under 350 LOC. Existing imports via dashboard_info_widgets.dart continue working. flutter analyze passes. Team tests unaffected.</done>
</task>

</tasks>

<verification>
1. `cd "/Users/karsten/NextCore/Core - Idrett/app" && flutter analyze lib/features/teams/` -- zero new errors
2. All original files under 350 LOC or converted to barrel
3. No extracted files exceed 350 LOC
4. Existing imports from edit_team_screen.dart, team_dashboard_body.dart still resolve
5. Team tests pass: `flutter test test/features/teams/`
6. Final check: `cd "/Users/karsten/NextCore/Core - Idrett/app" && flutter analyze` -- full project analyze shows no new errors
</verification>

<success_criteria>
- edit_team_members_tab.dart reduced from 423 to ~90 LOC
- dashboard_info_widgets.dart converted to barrel re-exporting 4 new files
- 6 new widget files created, all under 350 LOC
- flutter analyze passes with no new errors on teams feature
- All 8 original FSPLIT requirements satisfied across plans 01-04
</success_criteria>

<output>
After completion, create `.planning/phases/05-frontend-widget-extraction/05-04-SUMMARY.md`
</output>
