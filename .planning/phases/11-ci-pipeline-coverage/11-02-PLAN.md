---
phase: 11-ci-pipeline-coverage
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - .github/workflows/frontend.yml
autonomous: true

must_haves:
  truths:
    - "A PR touching app/ triggers flutter analyze + flutter test automatically"
    - "Pre-existing info-level warnings do not block CI"
    - "Frontend test coverage is generated in LCOV format for Codecov"
  artifacts:
    - path: ".github/workflows/frontend.yml"
      provides: "Frontend CI workflow with analyze, test, and coverage"
      contains: "flutter analyze"
  key_links:
    - from: ".github/workflows/frontend.yml"
      to: "app/**"
      via: "paths trigger filter"
      pattern: "paths:.*app/"
    - from: ".github/workflows/frontend.yml"
      to: "app/coverage/lcov.info"
      via: "flutter test --coverage output"
      pattern: "flutter test --coverage"
---

<objective>
Create the GitHub Actions CI workflow for the Flutter frontend that runs static analysis and tests with coverage on every PR.

Purpose: Automate frontend quality checks (CI-02) and generate coverage data (COV-02) so frontend regressions are caught before merge.
Output: `.github/workflows/frontend.yml` ready to trigger on PRs touching `app/**`.
</objective>

<execution_context>
@/Users/karsten/.claude/get-shit-done/workflows/execute-plan.md
@/Users/karsten/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-ci-pipeline-coverage/11-CONTEXT.md
@.planning/phases/11-ci-pipeline-coverage/11-RESEARCH.md
@app/pubspec.yaml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create frontend CI workflow</name>
  <files>.github/workflows/frontend.yml</files>
  <action>
Create `.github/workflows/frontend.yml` with the following structure:

**Workflow name:** `Frontend CI`

**Triggers:**
- `push` to `main` branch, paths: `app/**`, `.github/workflows/frontend.yml`
- `pull_request` to `main` branch, paths: `app/**`, `.github/workflows/frontend.yml`

**Job: `test`** on `ubuntu-latest`

**Steps:**
1. `actions/checkout@v4`
2. `subosito/flutter-action@v2` with:
   - `channel: 'stable'`
   - `cache: true` (enables built-in pub caching)
   - Do NOT pin `flutter-version` — use latest stable. The project requires Flutter 3.10+ which is well behind current stable (3.38.x). Pinning creates maintenance burden.
3. **Install dependencies:** `flutter pub get` with `working-directory: ./app`
4. **Analyze code:** `flutter analyze --no-fatal-warnings` with `working-directory: ./app`
   - Use `--no-fatal-warnings` per user decision to allow the 5 known info-level deprecation warnings (SharePlus, RadioGroup, use_build_context_synchronously)
   - Do NOT use `--fatal-infos` or `--fatal-warnings`
5. **Run tests with coverage:** `flutter test --coverage` with `working-directory: ./app`
   - Flutter natively outputs `coverage/lcov.info` (no conversion needed, unlike Dart backend)
6. **Upload coverage to Codecov:** `codecov/codecov-action@v5` with:
   - `files: ./app/coverage/lcov.info`
   - `flags: frontend`
   - `fail_ci_if_error: false` (do not block CI if Codecov is down — coverage is informational)
   - `token: ${{ secrets.CODECOV_TOKEN }}`

Important implementation details:
- Do NOT use `actions/cache` — `flutter-action@v2` with `cache: true` handles pub caching
- Do NOT pin Flutter version — latest stable is fine, project has `sdk: '>=3.10.0 <4.0.0'` constraint
- Do NOT use `continue-on-error` on analyze or test steps — those must fail the workflow
- Flutter test already produces LCOV — no conversion step needed (unlike backend)
  </action>
  <verify>Validate YAML syntax: `python3 -c "import yaml; yaml.safe_load(open('.github/workflows/frontend.yml'))"` from repo root. Verify the file contains all required steps: checkout, flutter-action, pub get, analyze, test with coverage, codecov upload.</verify>
  <done>`.github/workflows/frontend.yml` exists with valid YAML, triggers on app/** changes for push/PR to main, runs analyze with --no-fatal-warnings, runs tests with coverage, and uploads LCOV to Codecov.</done>
</task>

</tasks>

<verification>
- `.github/workflows/frontend.yml` is valid YAML
- Workflow triggers only on `app/**` and `.github/workflows/frontend.yml` path changes
- Workflow uses `subosito/flutter-action@v2` with `cache: true`
- Workflow uses `--no-fatal-warnings` for analyze
- Flutter test uses `--coverage` flag (produces LCOV natively)
- Codecov upload has `fail_ci_if_error: false` and `flags: frontend`
- No manual `actions/cache` step (flutter-action handles it)
</verification>

<success_criteria>
Frontend CI workflow file exists and is syntactically valid. The workflow will run analyze + test + coverage on PRs touching frontend code, with pre-existing warnings allowed through.
</success_criteria>

<output>
After completion, create `.planning/phases/11-ci-pipeline-coverage/11-02-SUMMARY.md`
</output>
