---
phase: 07-code-consistency-patterns
plan: 04
type: execute
wave: 2
depends_on: ["07-03"]
files_modified:
  - app/lib/core/theme.dart
  - app/lib/features/fines/presentation/fines_screen.dart
  - app/lib/features/fines/presentation/fine_boss_screen.dart
  - app/lib/features/fines/presentation/report_fine_sheet.dart
  - app/lib/features/statistics/presentation/player_profile_screen.dart
  - app/lib/features/statistics/presentation/widgets/player_profile_points_section.dart
  - app/lib/features/statistics/presentation/widgets/player_profile_monthly_section.dart
  - app/lib/features/statistics/presentation/widgets/player_profile_achievements_section.dart
  - app/lib/features/chat/presentation/widgets/chat_panel.dart
  - app/lib/features/chat/presentation/widgets/conversation_list_panel.dart
  - app/lib/features/chat/presentation/widgets/new_conversation_sheet.dart
  - app/lib/features/export/presentation/export_screen.dart
  - app/lib/features/profile/presentation/profile_screen.dart
autonomous: true

must_haves:
  truths:
    - "AppSpacing constants are defined in theme.dart with 8px grid values"
    - "All screens that display empty list/collection states use EmptyStateWidget"
    - "Screens with async data and empty states use when2() + EmptyStateWidget pattern"
  artifacts:
    - path: "app/lib/core/theme.dart"
      provides: "AppSpacing constants class"
      contains: "class AppSpacing"
  key_links:
    - from: "app/lib/features/*/presentation/*.dart"
      to: "app/lib/shared/widgets/empty_state_widget.dart"
      via: "EmptyStateWidget import"
      pattern: "EmptyStateWidget"
---

<objective>
Add AppSpacing constants to theme.dart and add EmptyStateWidget to screens that should have empty states but don't.

Purpose: Define spacing constants (CONS-06) for future consistency and close EmptyStateWidget gaps (CONS-03) in screens that display lists/collections.

Output: AppSpacing class in theme.dart, EmptyStateWidget added to screens missing empty state handling.
</objective>

<execution_context>
@/Users/karsten/.claude/get-shit-done/workflows/execute-plan.md
@/Users/karsten/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-code-consistency-patterns/07-RESEARCH.md
@app/lib/core/theme.dart
@app/lib/shared/widgets/empty_state_widget.dart
@app/lib/core/extensions/async_value_extensions.dart
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add AppSpacing constants to theme.dart</name>
  <files>app/lib/core/theme.dart</files>
  <action>
Add an `AppSpacing` class to `app/lib/core/theme.dart` AFTER the existing `StatusColors` extension (at the end of the file). This class defines spacing constants based on the 8px grid that the codebase already uses de facto.

```dart
/// Spacing constants following an 8px grid system.
///
/// De facto standards derived from codebase usage analysis:
/// - List/screen padding: 16 (lg)
/// - Item spacing: 8 (sm)
/// - Section spacing: 24 (xl)
/// - Card content padding: 12 (md) or 16 (lg)
class AppSpacing {
  AppSpacing._();

  /// 2px - Minimal spacing
  static const double xxs = 2;

  /// 4px - Tight spacing
  static const double xs = 4;

  /// 8px - Default item spacing
  static const double sm = 8;

  /// 12px - Card content padding
  static const double md = 12;

  /// 16px - Screen/list padding, standard spacing
  static const double lg = 16;

  /// 24px - Section spacing
  static const double xl = 24;

  /// 32px - Large section spacing
  static const double xxl = 32;

  /// 48px - Extra large spacing
  static const double xxxl = 48;
}
```

Do NOT migrate existing hard-coded EdgeInsets values in this task. The constants are defined for use in new code and future migration. The existing 300+ hard-coded values will be migrated incrementally over time (not in this phase, since it's too many changes with too much risk for a consistency enforcement phase).
  </action>
  <verify>
Run: `cd "/Users/karsten/NextCore/Core - Idrett/app" && flutter analyze`
Verify the class exists: `grep -n "class AppSpacing" app/lib/core/theme.dart` should return a match.
Verify constants: `grep -c "static const double" app/lib/core/theme.dart` should show 8 spacing constants.
  </verify>
  <done>AppSpacing class added to theme.dart with 8 constants (xxs through xxxl) following 8px grid. `flutter analyze` passes.</done>
</task>

<task type="auto">
  <name>Task 2: Add EmptyStateWidget to screens missing empty state handling</name>
  <files>
    app/lib/features/fines/presentation/fines_screen.dart
    app/lib/features/fines/presentation/fine_boss_screen.dart
    app/lib/features/fines/presentation/report_fine_sheet.dart
    app/lib/features/statistics/presentation/player_profile_screen.dart
    app/lib/features/statistics/presentation/widgets/player_profile_points_section.dart
    app/lib/features/statistics/presentation/widgets/player_profile_monthly_section.dart
    app/lib/features/statistics/presentation/widgets/player_profile_achievements_section.dart
    app/lib/features/chat/presentation/widgets/chat_panel.dart
    app/lib/features/chat/presentation/widgets/conversation_list_panel.dart
    app/lib/features/chat/presentation/widgets/new_conversation_sheet.dart
    app/lib/features/export/presentation/export_screen.dart
    app/lib/features/profile/presentation/profile_screen.dart
  </files>
  <action>
Examine each file to determine if it displays lists/collections that could be empty. For those that do, add EmptyStateWidget handling.

**Pattern to apply:**
```dart
if (data.isEmpty) {
  return EmptyStateWidget(
    icon: Icons.appropriate_icon,
    title: 'Norwegian title',
    subtitle: 'Norwegian subtitle',
  );
}
```

**For each file, first check if:**
1. It already has EmptyStateWidget (skip if yes)
2. It displays a list/collection (add EmptyStateWidget if yes)
3. It uses when2() for async data (add EmptyStateWidget inside the data callback if applicable)
4. It's a detail screen showing a single item (skip -- EmptyStateWidget is for lists/collections)

**Specific guidance per feature:**

Fines screens:
- `fines_screen.dart` -- already has EmptyStateWidget (2 uses). Verify coverage is complete.
- `fine_boss_screen.dart` -- already has EmptyStateWidget (2 uses). Verify.
- `report_fine_sheet.dart` -- has when2() but may need EmptyStateWidget for empty member list.

Statistics screens:
- `player_profile_screen.dart` -- detail screen, may need empty state for sub-sections.
- `player_profile_points_section.dart` -- may need empty state for empty points list.
- `player_profile_monthly_section.dart` -- may need empty state for empty monthly data.
- `player_profile_achievements_section.dart` -- already has EmptyStateWidget (2 uses). Verify.

Chat screens:
- `chat_panel.dart` -- has when2() but needs EmptyStateWidget for empty message list.
- `conversation_list_panel.dart` -- has when2() but needs EmptyStateWidget for empty conversations.
- `new_conversation_sheet.dart` -- has when2() but needs EmptyStateWidget for empty member list.

Export screen:
- `export_screen.dart` -- has when2() but needs EmptyStateWidget for empty export history.

Profile screen:
- `profile_screen.dart` -- has when2(), detail screen, may need empty state for sub-lists.

**For each file that needs EmptyStateWidget:**
1. Add import: `import '../../../shared/widgets/widgets.dart';` (or appropriate relative path)
2. Add empty check inside the data callback of when2()
3. Use Norwegian text for title and subtitle
4. Choose an appropriate Material icon

**Norwegian empty state messages by feature:**
- Fines (no fines): icon: `Icons.gavel_outlined`, title: `'Ingen bøter'`, subtitle: `'Det er ingen bøter å vise'`
- Chat (no messages): icon: `Icons.chat_outlined`, title: `'Ingen meldinger'`, subtitle: `'Start en samtale'`
- Chat (no conversations): icon: `Icons.forum_outlined`, title: `'Ingen samtaler'`, subtitle: `'Start en ny samtale'`
- Members (empty list): icon: `Icons.group_outlined`, title: `'Ingen medlemmer'`, subtitle: `'Ingen medlemmer å vise'`
- Export (no history): icon: `Icons.download_outlined`, title: `'Ingen eksporter'`, subtitle: `'Ingen eksporthistorikk å vise'`
- Points (no points): icon: `Icons.stars_outlined`, title: `'Ingen poeng'`, subtitle: `'Ingen poengdata å vise'`
- Monthly (no data): icon: `Icons.calendar_month_outlined`, title: `'Ingen data'`, subtitle: `'Ingen månedlig data å vise'`

**IMPORTANT:** Only add EmptyStateWidget where there is genuinely a list/collection that can be empty. Do NOT add it to detail screens that show a single object, or to screens where the empty state is already handled by existing UI logic (e.g., a "no data" text already shown).
  </action>
  <verify>
Run: `cd "/Users/karsten/NextCore/Core - Idrett/app" && flutter analyze`
Run: `cd "/Users/karsten/NextCore/Core - Idrett/app" && flutter test`
Verify increased coverage: `grep -rn "EmptyStateWidget" app/lib/ | wc -l` should be higher than the current 26 occurrences.
  </verify>
  <done>EmptyStateWidget added to screens that display lists/collections without empty state handling. `flutter analyze` and `flutter test` pass. EmptyStateWidget usage increased from 26 occurrences.</done>
</task>

</tasks>

<verification>
1. `flutter analyze` passes with only pre-existing warnings
2. `flutter test` passes
3. AppSpacing class exists in theme.dart with 8 constants
4. EmptyStateWidget usage count increased
5. All list/collection screens have empty state handling
</verification>

<success_criteria>
- AppSpacing class defined in theme.dart with 8px grid constants
- All screens displaying lists/collections have EmptyStateWidget for empty states
- Frontend analyze and tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/07-code-consistency-patterns/07-04-SUMMARY.md`
</output>
