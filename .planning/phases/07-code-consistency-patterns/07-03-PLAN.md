---
phase: 07-code-consistency-patterns
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - app/lib/features/tests/presentation/test_detail_screen.dart
  - app/lib/features/activities/presentation/activity_detail_screen.dart
  - app/lib/features/activities/presentation/widgets/activity_detail_content.dart
  - app/lib/features/export/presentation/export_screen.dart
  - app/lib/features/teams/presentation/widgets/member_tile.dart
  - app/lib/features/teams/presentation/widgets/member_action_dialogs.dart
  - app/lib/features/activities/presentation/edit_instance_screen.dart
  - app/lib/features/activities/presentation/activities_screen.dart
  - app/lib/features/mini_activities/presentation/widgets/team_division_sheet.dart
  - app/lib/features/mini_activities/presentation/widgets/handicap_sheet.dart
  - app/lib/features/documents/presentation/documents_screen.dart
  - app/lib/features/teams/presentation/widgets/team_members_section.dart
  - app/lib/features/mini_activities/presentation/widgets/stopwatch_time_sheet.dart
  - app/lib/features/profile/presentation/edit_profile_screen.dart
  - app/lib/features/absence/presentation/widgets/pending_absence_card.dart
  - app/lib/features/points/presentation/points_config_screen.dart
  - app/lib/features/settings/presentation/widgets/settings_dialogs.dart
  - app/lib/features/documents/presentation/upload_document_sheet.dart
  - app/lib/features/absence/presentation/widgets/categories_tab.dart
  - app/lib/features/mini_activities/presentation/widgets/stopwatch_setup_sheet.dart
  - app/lib/features/mini_activities/presentation/widgets/create_standalone_activity_sheet.dart
  - app/lib/features/mini_activities/presentation/widgets/match_result_sheet.dart
  - app/lib/features/mini_activities/presentation/widgets/tournament_setup_sheet.dart
  - app/lib/features/mini_activities/presentation/widgets/adjustment_sheet.dart
  - app/lib/features/absence/presentation/widgets/pending_absences_tab.dart
  - app/lib/features/mini_activities/presentation/widgets/team_card_dialogs.dart
  - app/lib/features/teams/presentation/edit_team_screen.dart
  - app/lib/features/mini_activities/presentation/screens/tournament_screen.dart
  - app/lib/features/teams/presentation/widgets/edit_team_trainer_types_tab.dart
  - app/lib/features/teams/presentation/widgets/edit_team_general_tab.dart
  - app/lib/features/teams/presentation/widgets/team_invite_dialog.dart
  - app/lib/features/teams/presentation/create_team_screen.dart
  - app/lib/features/activities/presentation/create_activity_screen.dart
autonomous: true

must_haves:
  truths:
    - "No frontend file uses raw ScaffoldMessenger.of(context).showSnackBar() for user feedback"
    - "All user-facing feedback messages go through ErrorDisplayService"
    - "Existing error_display_service.dart is the only file creating SnackBar instances"
  artifacts:
    - path: "app/lib/core/services/error_display_service.dart"
      provides: "Centralized SnackBar creation (already exists)"
  key_links:
    - from: "app/lib/features/*/presentation/*.dart"
      to: "app/lib/core/services/error_display_service.dart"
      via: "ErrorDisplayService.showSuccess/showWarning/showInfo"
      pattern: "ErrorDisplayService\\.show"
---

<objective>
Migrate all 33 frontend files from raw ScaffoldMessenger/SnackBar usage to the centralized ErrorDisplayService.

Purpose: Enforce consistent error/success feedback patterns (CONS-04). ErrorDisplayService provides consistent styling, Norwegian messages, and centralized control over feedback display.

Output: Zero raw SnackBar/ScaffoldMessenger usage outside of ErrorDisplayService itself.
</objective>

<execution_context>
@/Users/karsten/.claude/get-shit-done/workflows/execute-plan.md
@/Users/karsten/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-code-consistency-patterns/07-RESEARCH.md
@app/lib/core/services/error_display_service.dart
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate raw SnackBar to ErrorDisplayService in first 17 files</name>
  <files>
    app/lib/features/tests/presentation/test_detail_screen.dart
    app/lib/features/activities/presentation/activity_detail_screen.dart
    app/lib/features/activities/presentation/widgets/activity_detail_content.dart
    app/lib/features/export/presentation/export_screen.dart
    app/lib/features/teams/presentation/widgets/member_tile.dart
    app/lib/features/teams/presentation/widgets/member_action_dialogs.dart
    app/lib/features/activities/presentation/edit_instance_screen.dart
    app/lib/features/activities/presentation/activities_screen.dart
    app/lib/features/mini_activities/presentation/widgets/team_division_sheet.dart
    app/lib/features/mini_activities/presentation/widgets/handicap_sheet.dart
    app/lib/features/documents/presentation/documents_screen.dart
    app/lib/features/teams/presentation/widgets/team_members_section.dart
    app/lib/features/mini_activities/presentation/widgets/stopwatch_time_sheet.dart
    app/lib/features/profile/presentation/edit_profile_screen.dart
    app/lib/features/absence/presentation/widgets/pending_absence_card.dart
    app/lib/features/points/presentation/points_config_screen.dart
    app/lib/features/settings/presentation/widgets/settings_dialogs.dart
  </files>
  <action>
For each file, find all `ScaffoldMessenger.of(context).showSnackBar(SnackBar(...))` patterns and replace with the appropriate ErrorDisplayService method.

**Migration rules:**

1. **Success feedback** (green, positive action completed):
```dart
// FROM:
ScaffoldMessenger.of(context).showSnackBar(
  const SnackBar(content: Text('Lagret')),
);

// TO:
ErrorDisplayService.showSuccess('Lagret');
```

2. **Warning/error feedback** (red/orange, action failed):
```dart
// FROM:
ScaffoldMessenger.of(context).showSnackBar(
  SnackBar(content: Text('Kunne ikke lagre: $e')),
);

// TO:
ErrorDisplayService.showWarning('Kunne ikke lagre');
```
IMPORTANT: Remove any `$e` from messages -- use generic Norwegian message instead.

3. **Info feedback** (blue, informational):
```dart
// FROM:
ScaffoldMessenger.of(context).showSnackBar(
  const SnackBar(content: Text('Kopiert til utklippstavlen')),
);

// TO:
ErrorDisplayService.showInfo('Kopiert til utklippstavlen');
```

4. **Feedback with background color hint:**
- `backgroundColor: Colors.green` / `Colors.green.shade*` -> `showSuccess()`
- `backgroundColor: Colors.red` / `Colors.red.shade*` -> `showWarning()`
- `backgroundColor: Colors.orange` / `Colors.orange.shade*` -> `showWarning()`
- `backgroundColor: Colors.blue` / no background -> `showInfo()` or `showSuccess()` depending on context

**Import to add** (if not already present):
```dart
import '../../../core/services/error_display_service.dart';
// OR the appropriate relative path from each file
```

**Norwegian message guidelines:**
- If the existing message is in English, translate to Norwegian
- If the message includes `$e`, remove it and use generic Norwegian text
- Keep existing Norwegian messages as-is

**IMPORTANT:** Do NOT change ErrorDisplayService itself (it uses SnackBar internally, that's correct). Only change files that directly construct SnackBar.

Also remove any now-unused `ScaffoldMessenger` imports or `context` usage that was only needed for showing SnackBars (but keep `context` if it's used for other things like Navigator).
  </action>
  <verify>
Run: `cd "/Users/karsten/NextCore/Core - Idrett/app" && flutter analyze`
Verify migration for these 17 files: `grep -rn "ScaffoldMessenger.of(context)" app/lib/features/tests/ app/lib/features/activities/ app/lib/features/export/ app/lib/features/teams/presentation/widgets/member_tile.dart app/lib/features/teams/presentation/widgets/member_action_dialogs.dart app/lib/features/documents/ app/lib/features/teams/presentation/widgets/team_members_section.dart app/lib/features/mini_activities/presentation/widgets/stopwatch_time_sheet.dart app/lib/features/profile/ app/lib/features/absence/presentation/widgets/pending_absence_card.dart app/lib/features/points/ app/lib/features/settings/` should return 0 results.
  </verify>
  <done>17 files migrated from raw SnackBar to ErrorDisplayService. Zero ScaffoldMessenger.of(context) remaining in these files. `flutter analyze` passes.</done>
</task>

<task type="auto">
  <name>Task 2: Migrate raw SnackBar to ErrorDisplayService in remaining 16 files</name>
  <files>
    app/lib/features/documents/presentation/upload_document_sheet.dart
    app/lib/features/absence/presentation/widgets/categories_tab.dart
    app/lib/features/mini_activities/presentation/widgets/stopwatch_setup_sheet.dart
    app/lib/features/mini_activities/presentation/widgets/create_standalone_activity_sheet.dart
    app/lib/features/mini_activities/presentation/widgets/match_result_sheet.dart
    app/lib/features/mini_activities/presentation/widgets/tournament_setup_sheet.dart
    app/lib/features/mini_activities/presentation/widgets/adjustment_sheet.dart
    app/lib/features/absence/presentation/widgets/pending_absences_tab.dart
    app/lib/features/mini_activities/presentation/widgets/team_card_dialogs.dart
    app/lib/features/teams/presentation/edit_team_screen.dart
    app/lib/features/mini_activities/presentation/screens/tournament_screen.dart
    app/lib/features/teams/presentation/widgets/edit_team_trainer_types_tab.dart
    app/lib/features/teams/presentation/widgets/edit_team_general_tab.dart
    app/lib/features/teams/presentation/widgets/team_invite_dialog.dart
    app/lib/features/teams/presentation/create_team_screen.dart
    app/lib/features/activities/presentation/create_activity_screen.dart
  </files>
  <action>
Apply the same migration rules from Task 1 to the remaining 16 files.

Follow the same replacement patterns:
- Success feedback -> `ErrorDisplayService.showSuccess('Norwegian message')`
- Warning/error feedback -> `ErrorDisplayService.showWarning('Norwegian message')`
- Info feedback -> `ErrorDisplayService.showInfo('Norwegian message')`

Add the appropriate import for ErrorDisplayService in each file.

Remove any `$e` from error messages.
Translate any English messages to Norwegian.
Remove unused ScaffoldMessenger-related code.

After completing all 16 files, do a final comprehensive check across the ENTIRE `app/lib/` directory to confirm zero raw SnackBar usage remains (excluding `error_display_service.dart` itself and `theme.dart` SnackBar theming).
  </action>
  <verify>
Run: `cd "/Users/karsten/NextCore/Core - Idrett/app" && flutter analyze`
Run: `cd "/Users/karsten/NextCore/Core - Idrett/app" && flutter test`
Final check: `grep -rn "ScaffoldMessenger.of(context)" app/lib/ | grep -v error_display_service` should return 0 results.
Also: `grep -rn "SnackBar(" app/lib/ | grep -v error_display_service | grep -v theme` should return 0 results.
  </verify>
  <done>All 33 files migrated. Zero raw ScaffoldMessenger/SnackBar usage remains outside ErrorDisplayService. `flutter analyze` and `flutter test` pass.</done>
</task>

</tasks>

<verification>
1. `flutter analyze` passes with only pre-existing warnings
2. `flutter test` passes (no behavioral changes)
3. `grep -rn "ScaffoldMessenger.of(context)" app/lib/ | grep -v error_display_service` returns zero results
4. `grep -rn "SnackBar(" app/lib/ | grep -v error_display_service | grep -v theme` returns zero results
5. All user feedback goes through ErrorDisplayService
</verification>

<success_criteria>
- Zero raw SnackBar/ScaffoldMessenger usage outside of ErrorDisplayService
- All feedback messages in Norwegian
- No `$e` in any user-facing message
- Frontend analyze and tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/07-code-consistency-patterns/07-03-SUMMARY.md`
</output>
