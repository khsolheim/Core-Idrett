---
phase: 07-code-consistency-patterns
plan: 02
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - backend/lib/api/fines_handler.dart
  - backend/lib/api/points_config_handler.dart
  - backend/lib/api/mini_activity_teams_handler.dart
  - backend/lib/api/mini_activities_handler.dart
  - backend/lib/api/mini_activity_statistics_handler.dart
  - backend/lib/api/activities_handler.dart
  - backend/lib/api/activity_instances_handler.dart
  - backend/lib/api/leaderboards_handler.dart
  - backend/lib/api/leaderboard_entries_handler.dart
  - backend/lib/api/tournament_groups_handler.dart
  - backend/lib/api/tournaments_handler.dart
  - backend/lib/api/team_settings_handler.dart
  - backend/lib/api/teams_handler.dart
  - backend/lib/api/achievements_handler.dart
  - backend/lib/api/stopwatch_times_handler.dart
  - backend/lib/api/stopwatch_handler.dart
  - backend/lib/api/test_results_handler.dart
  - backend/lib/api/tests_handler.dart
  - backend/lib/api/absence_categories_handler.dart
  - backend/lib/api/absence_handler.dart
  - backend/lib/api/documents_handler.dart
  - backend/lib/api/notifications_handler.dart
  - backend/lib/api/messages_handler.dart
  - backend/lib/api/seasons_handler.dart
autonomous: true

must_haves:
  truths:
    - "No backend endpoint returns {'success': true} as response body"
    - "All void mutation endpoints return {'message': 'Norwegian confirmation'}"
    - "Frontend continues working since it never reads 'success' field from response"
  artifacts:
    - path: "backend/lib/api/teams_handler.dart"
      provides: "Standardized mutation responses"
    - path: "backend/lib/api/fines_handler.dart"
      provides: "Standardized mutation responses"
    - path: "backend/lib/api/messages_handler.dart"
      provides: "Standardized mutation responses"
  key_links:
    - from: "app/lib/features/*/data/*_repository.dart"
      to: "backend/lib/api/*_handler.dart"
      via: "HTTP mutation calls that await without reading response body"
      pattern: "await _client\\.(delete|post|patch)"
---

<objective>
Remove redundant `{'success': true}` response wrappers from all backend mutation endpoints and replace with meaningful Norwegian confirmation messages.

Purpose: Standardize API response shapes (CONS-05). The `{'success': true}` pattern is redundant since HTTP 200 already indicates success, and the frontend never reads this field.

Output: All ~40 `{'success': true}` occurrences across 24 handler files replaced with `{'message': 'Norwegian confirmation'}`.
</objective>

<execution_context>
@/Users/karsten/.claude/get-shit-done/workflows/execute-plan.md
@/Users/karsten/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-code-consistency-patterns/07-RESEARCH.md
@backend/lib/api/helpers/response_helpers.dart
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace {'success': true} with Norwegian confirmation messages in first 12 handlers</name>
  <files>
    backend/lib/api/teams_handler.dart
    backend/lib/api/team_settings_handler.dart
    backend/lib/api/messages_handler.dart
    backend/lib/api/fines_handler.dart
    backend/lib/api/activities_handler.dart
    backend/lib/api/activity_instances_handler.dart
    backend/lib/api/documents_handler.dart
    backend/lib/api/notifications_handler.dart
    backend/lib/api/absence_handler.dart
    backend/lib/api/absence_categories_handler.dart
    backend/lib/api/seasons_handler.dart
    backend/lib/api/achievements_handler.dart
  </files>
  <action>
Replace all `resp.ok({'success': true})` occurrences with contextual Norwegian confirmation messages. Use the endpoint's action to determine the message:

**Replacement pattern:**
```dart
// FROM:
return resp.ok({'success': true});

// TO (use context-appropriate message):
return resp.ok({'message': 'Norwegian confirmation'});
```

**Standard messages by action type:**
- Delete operations: `'Slettet'`
- Update/save operations: `'Oppdatert'`
- Create operations: use the created object response instead (already handled)
- Status change (activate/deactivate/archive): `'Status oppdatert'`
- Send/notify operations: `'Sendt'`
- Register operations: `'Registrert'`

**Specific replacements per handler:**

teams_handler.dart (~5 occurrences):
- updateMemberPermissions: `'Tillatelser oppdatert'`
- deactivateMember: `'Medlem deaktivert'`
- reactivateMember: `'Medlem reaktivert'`
- removeMember: `'Medlem fjernet'`
- setInjuredStatus: `'Status oppdatert'`

team_settings_handler.dart (~1):
- updateSettings: `'Innstillinger oppdatert'`

messages_handler.dart (~3):
- editMessage: `'Melding oppdatert'`
- deleteMessage: `'Melding slettet'`
- markConversationsRead: `'Markert som lest'`

fines_handler.dart (~1):
- deleteFine: `'Bot slettet'`

activities_handler.dart (~1):
- deleteActivity: `'Aktivitet slettet'`

activity_instances_handler.dart (~3):
- cancelInstance: `'Avlyst'`
- updateInstance: `'Oppdatert'`
- For the one with extra data (`'success': true, ...`), keep the extra fields but replace success: `{'message': 'Registrert', ...otherFields}`

documents_handler.dart (~1):
- deleteDocument: `'Dokument slettet'`

notifications_handler.dart (~1):
- registerToken: `'Token registrert'`

absence_handler.dart (~1):
- deleteAbsence: `'Fravær slettet'`

absence_categories_handler.dart (~1):
- deleteCategory: `'Kategori slettet'`

seasons_handler.dart (~1):
- deleteSeason: `'Sesong slettet'`

achievements_handler.dart (~1):
- deleteAchievement: `'Prestasjon slettet'`

**IMPORTANT:** For `activity_instances_handler.dart` line ~272, there is a `'success': true` alongside other data fields. Replace `'success': true` with `'message': 'Registrert'` but keep the other fields.
  </action>
  <verify>
Run: `cd "/Users/karsten/NextCore/Core - Idrett/backend" && dart analyze`
Verify: `grep -rn "'success': true" backend/lib/api/teams_handler.dart backend/lib/api/team_settings_handler.dart backend/lib/api/messages_handler.dart backend/lib/api/fines_handler.dart backend/lib/api/activities_handler.dart backend/lib/api/activity_instances_handler.dart backend/lib/api/documents_handler.dart backend/lib/api/notifications_handler.dart backend/lib/api/absence_handler.dart backend/lib/api/absence_categories_handler.dart backend/lib/api/seasons_handler.dart backend/lib/api/achievements_handler.dart` returns 0 results.
  </verify>
  <done>All `{'success': true}` replaced in 12 handlers with Norwegian confirmation messages. `dart analyze` passes.</done>
</task>

<task type="auto">
  <name>Task 2: Replace {'success': true} in remaining 12 handlers + verify frontend compatibility</name>
  <files>
    backend/lib/api/mini_activities_handler.dart
    backend/lib/api/mini_activity_teams_handler.dart
    backend/lib/api/mini_activity_statistics_handler.dart
    backend/lib/api/tournaments_handler.dart
    backend/lib/api/tournament_groups_handler.dart
    backend/lib/api/leaderboards_handler.dart
    backend/lib/api/leaderboard_entries_handler.dart
    backend/lib/api/points_config_handler.dart
    backend/lib/api/stopwatch_handler.dart
    backend/lib/api/stopwatch_times_handler.dart
    backend/lib/api/tests_handler.dart
    backend/lib/api/test_results_handler.dart
  </files>
  <action>
Continue replacing `resp.ok({'success': true})` in the remaining 12 handlers:

mini_activities_handler.dart (~3):
- deleteMiniActivity: `'Miniaktivitet slettet'`
- archiveMiniActivity: `'Arkivert'`
- unarchiveMiniActivity: `'Gjenopprettet'`

mini_activity_teams_handler.dart (~1):
- resetDivision: `'Lag tilbakestilt'`

mini_activity_statistics_handler.dart (~1):
- recalculate: `'Statistikk oppdatert'`

tournaments_handler.dart (~1):
- deleteTournament: `'Turnering slettet'`

tournament_groups_handler.dart (~1):
- deleteGroup: `'Gruppe slettet'`

leaderboards_handler.dart (~1):
- deleteLeaderboard: `'Resultatliste slettet'`

leaderboard_entries_handler.dart (~3):
- deleteEntry: `'Oppføring slettet'`
- toggleOptOut: `'Oppdatert'`
- resetPoints: `'Poeng tilbakestilt'`

points_config_handler.dart (~2):
- deleteConfig: `'Konfigurasjon slettet'`
- For opt_out response with `'success': true, 'opt_out': optOut`, replace with `'message': 'Oppdatert', 'opt_out': optOut`

stopwatch_handler.dart (~2):
- deleteStopwatch: `'Stoppeklokke slettet'`
- resetStopwatch: `'Tilbakestilt'`

stopwatch_times_handler.dart (~3):
- deleteTime: `'Tid slettet'`
- deleteAllTimes: `'Alle tider slettet'`
- updateTime: `'Tid oppdatert'`

tests_handler.dart (~1):
- deleteTest: `'Test slettet'`

test_results_handler.dart (~1):
- deleteResult: `'Resultat slettet'`

After replacing all, verify frontend compatibility by confirming NO frontend repository reads the `success` field from mutation responses. Run:
```
grep -rn "success" app/lib/features/*/data/*_repository.dart
```
This should return zero results related to response parsing (already confirmed during research).
  </action>
  <verify>
Run: `cd "/Users/karsten/NextCore/Core - Idrett/backend" && dart analyze && dart test`
Verify zero remaining: `grep -rn "'success': true" backend/lib/api/` should return 0 results.
Frontend check: `grep -rn "\['success'\]" app/lib/` should return 0 results.
  </verify>
  <done>All ~40 `{'success': true}` occurrences replaced across all 24 handlers. Backend analyze and tests pass. Frontend confirmed not reading 'success' field.</done>
</task>

</tasks>

<verification>
1. `dart analyze` in backend/ passes with zero errors
2. `dart test` in backend/ passes (behavioral change is response body only, not status codes)
3. `grep -rn "'success': true" backend/lib/api/` returns zero results
4. Frontend repositories do not reference 'success' field
</verification>

<success_criteria>
- Zero `{'success': true}` patterns remain in any handler
- All mutation endpoints return `{'message': 'Norwegian confirmation'}` instead
- Backend analyze and tests pass
- Frontend unaffected (confirmed no 'success' field reads)
</success_criteria>

<output>
After completion, create `.planning/phases/07-code-consistency-patterns/07-02-SUMMARY.md`
</output>
