---
phase: 01-test-infrastructure
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - app/pubspec.yaml
  - app/lib/data/models/user.dart
  - app/lib/data/models/team.dart
  - app/lib/data/models/activity.dart
  - app/lib/data/models/message.dart
  - app/lib/data/models/conversation.dart
  - app/lib/data/models/fine.dart
  - app/lib/data/models/document.dart
  - app/lib/data/models/absence.dart
  - app/lib/data/models/notification.dart
  - app/lib/data/models/export_log.dart
  - app/lib/data/models/stopwatch.dart
  - app/lib/data/models/statistics_core.dart
  - app/lib/data/models/statistics_player.dart
  - app/lib/data/models/points_config_models.dart
  - app/lib/data/models/points_config_leaderboard.dart
  - app/lib/data/models/tournament_models.dart
  - app/lib/data/models/tournament_group_models.dart
  - app/lib/data/models/achievement_models.dart
  - app/lib/data/models/achievement_enums.dart
  - app/lib/data/models/mini_activity_models.dart
  - app/lib/data/models/mini_activity_support.dart
  - app/lib/data/models/mini_activity_statistics_core.dart
  - app/lib/data/models/mini_activity_statistics_aggregate.dart
  - app/test/helpers/test_data.dart
autonomous: true

must_haves:
  truths:
    - "All frontend models support structural equality via Equatable (fromJson(toJson(m)) == m)"
    - "Frontend test data factories exist for ALL core entities with realistic Norwegian data"
    - "Existing frontend tests still pass after Equatable migration"
    - "flutter pub get succeeds with equatable dependency"
    - "flutter analyze shows no new errors after Equatable migration"
  artifacts:
    - path: "app/pubspec.yaml"
      provides: "equatable dependency in main dependencies"
      contains: "equatable"
    - path: "app/test/helpers/test_data.dart"
      provides: "Updated test data factories with Norwegian names and all model coverage"
      contains: "TestUserFactory"
  key_links:
    - from: "app/lib/data/models/*.dart"
      to: "package:equatable/equatable.dart"
      via: "extends Equatable"
      pattern: "class .* extends Equatable"
    - from: "app/test/helpers/test_data.dart"
      to: "app/lib/data/models/*.dart"
      via: "import and factory instantiation"
      pattern: "import.*package:core_idrett/data/models/"
---

<objective>
Migrate all frontend models to Equatable for structural equality and expand test data factories to cover ALL models with realistic Norwegian test data.

Purpose: Frontend models currently lack == and hashCode, making roundtrip assertion impossible. The existing test data factories cover only 8 entities and use generic English names. This plan makes all frontend models equality-testable and expands factory coverage to every model.

Output: Frontend models with Equatable, comprehensive test data factories with Norwegian names covering all entities.
</objective>

<execution_context>
@/Users/karsten/.claude/get-shit-done/workflows/execute-plan.md
@/Users/karsten/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-test-infrastructure/01-RESEARCH.md
@.planning/phases/01-test-infrastructure/01-CONTEXT.md

# Key source files
@app/pubspec.yaml
@app/lib/data/models/user.dart
@app/lib/data/models/team.dart
@app/test/helpers/test_data.dart
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Equatable dependency and migrate all frontend models</name>
  <files>
    app/pubspec.yaml
    app/lib/data/models/user.dart
    app/lib/data/models/team.dart
    app/lib/data/models/activity.dart
    app/lib/data/models/message.dart
    app/lib/data/models/conversation.dart
    app/lib/data/models/fine.dart
    app/lib/data/models/document.dart
    app/lib/data/models/absence.dart
    app/lib/data/models/notification.dart
    app/lib/data/models/export_log.dart
    app/lib/data/models/stopwatch.dart
    app/lib/data/models/statistics_core.dart
    app/lib/data/models/statistics_player.dart
    app/lib/data/models/points_config_models.dart
    app/lib/data/models/points_config_leaderboard.dart
    app/lib/data/models/tournament_models.dart
    app/lib/data/models/tournament_group_models.dart
    app/lib/data/models/achievement_models.dart
    app/lib/data/models/achievement_enums.dart
    app/lib/data/models/mini_activity_models.dart
    app/lib/data/models/mini_activity_support.dart
    app/lib/data/models/mini_activity_statistics_core.dart
    app/lib/data/models/mini_activity_statistics_aggregate.dart
  </files>
  <action>
    1. Add `equatable: ^2.0.5` under `dependencies:` in app/pubspec.yaml (NOT dev_dependencies, since models are in lib/).
       Run `flutter pub get` from app/.

    2. Migrate ALL frontend model classes to extend Equatable:
       - Add `import 'package:equatable/equatable.dart';` to each model file
       - Change each class from `class Foo {` to `class Foo extends Equatable {`
       - Add `@override List<Object?> get props => [field1, field2, ...];` with ALL fields
       - Add `const` to constructors where possible
       - Do NOT change any existing fromJson/toJson/copyWith logic
       - Do NOT modify barrel export files (tournament.dart, mini_activity.dart, etc.)
       - Do NOT modify enum-only files (they already support ==)

    3. Frontend model files to migrate (21 files with classes, skip enum-only and barrel files):
       - user.dart (1 class: User) - has copyWith, keep it
       - team.dart (4 classes: Team, TeamMember, TrainerType, TeamSettings)
       - activity.dart (5 classes: Activity, ActivityInstance, ActivityResponseItem, DashboardActivity, ActivitySummary)
       - message.dart (1 class: Message)
       - conversation.dart (1 class: Conversation)
       - fine.dart (6 classes: Fine, FineRule, FineAppeal, FineBalance, FineSummary, FinePayment)
       - document.dart (2 classes: check file)
       - absence.dart (3 classes: check file)
       - notification.dart (2 classes: check file)
       - export_log.dart (2 classes: check file)
       - stopwatch.dart (3 classes: check file)
       - statistics_core.dart (5 classes: check file)
       - statistics_player.dart (6 classes: check file)
       - points_config_models.dart (3 classes: check file)
       - points_config_leaderboard.dart (3 classes: check file)
       - tournament_models.dart (4 classes: check file)
       - tournament_group_models.dart (5 classes: check file)
       - achievement_models.dart (4 classes: check file)
       - achievement_enums.dart (1 class: AchievementIcon - check if class or enum)
       - mini_activity_models.dart (2 classes: check file)
       - mini_activity_support.dart (6 classes: check file)
       - mini_activity_statistics_core.dart (3 classes: check file)
       - mini_activity_statistics_aggregate.dart (3 classes: check file)

    4. IMPORTANT: Frontend models parse DateTime from strings (e.g., `DateTime.parse(json['created_at'] as String)`).
       This is different from backend. The Equatable props should include all fields as-is.

    5. Some frontend models have `copyWith()` methods. These should remain unchanged.
       Equatable does NOT conflict with copyWith.

    6. Enum-only files to SKIP (no Equatable needed):
       - tournament_enums.dart
       - mini_activity_enums.dart
       - mini_activity_statistics_enums.dart
       - points_config_enums.dart
  </action>
  <verify>
    Run from app/:
    - `flutter pub get` succeeds
    - `flutter analyze` shows no new errors/warnings (5 pre-existing info-level warnings are OK)
    - `flutter test` - existing tests still pass
    - Spot-check a few model files have `extends Equatable` and `props`
  </verify>
  <done>
    All frontend model classes (~64) extend Equatable with complete props lists. Existing tests pass. flutter analyze clean.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update frontend test data factories with Norwegian names and full model coverage</name>
  <files>
    app/test/helpers/test_data.dart
  </files>
  <action>
    1. Read the current `app/test/helpers/test_data.dart` to understand existing 8 factories:
       TestUserFactory, TestTeamFactory, TestTeamMemberFactory, TestActivityFactory,
       TestActivityInstanceFactory, TestFineFactory, TestFineRuleFactory, TestMessageFactory.

    2. Update existing factories:
       - Change default names from English to Norwegian:
         - TestUserFactory: 'Test User N' -> 'Ola Nordmann N' (cycle through Norwegian names list)
         - TestUserFactory: emails from 'userN@test.com' -> 'ola.nordmannN@example.no'
         - TestTeamFactory: 'Test Team N' -> cycle through ['Rosenborg BK', 'Brann FK', 'Viking FK', 'Molde FK', 'Vaalerenga IF']
         - TestTeamMemberFactory: 'Member N' -> cycle through Norwegian names
         - TestActivityFactory: 'Test Activity N' -> 'Trening N' / 'Kamp N'
         - TestActivityInstanceFactory: 'Test Instance N' -> 'Treningsokt N'
         - TestFineFactory: 'Test fine N' -> 'For sent N' / 'Gloemt utstyr N'
         - TestFineRuleFactory: 'Test Rule N' -> 'For sent til trening'
         - TestMessageFactory: 'Test message N' -> 'Melding N'
       - Change `DateTime.now()` to `DateTime.parse('2024-01-15T10:00:00Z')` for determinism

    3. Add NEW factories for all uncovered models. For each, read the corresponding model file
       to understand constructor parameters, then create a factory with realistic Norwegian defaults.
       Use UTC DateTime.parse() for all timestamp defaults.

       New factories needed:
       - TestConversationFactory (from conversation.dart)
       - TestFineAppealFactory, TestFineBalanceFactory, TestFineSummaryFactory, TestFinePaymentFactory (from fine.dart)
       - TestDocumentFactory (+ sub-models from document.dart)
       - TestAbsenceFactory (+ sub-models from absence.dart)
       - TestNotificationFactory (from notification.dart)
       - TestExportLogFactory (from export_log.dart)
       - TestStopwatchFactory (+ sub-models from stopwatch.dart)
       - TestStatisticsFactory (all classes from statistics_core.dart and statistics_player.dart)
       - TestPointsConfigFactory (from points_config_models.dart and points_config_leaderboard.dart)
       - TestTournamentFactory (from tournament_models.dart)
       - TestTournamentGroupFactory (from tournament_group_models.dart)
       - TestAchievementFactory (from achievement_models.dart)
       - TestMiniActivityFactory (from mini_activity_models.dart)
       - TestMiniActivitySupportFactory (from mini_activity_support.dart sub-models)
       - TestMiniActivityStatisticsFactory (from mini_activity_statistics_core.dart + aggregate)

    4. Update `resetAllTestFactories()` to include ALL new factory classes.

    5. IMPORTANT: Do NOT break existing test files that use the current factories.
       Only ADD parameters and change default values. Existing tests pass explicit values
       so changing defaults won't break them.

    6. Norwegian names list for cycling (use modulo):
       ['Ola Nordmann', 'Kari Hansen', 'Per Olsen', 'Lise Andersen', 'Erik Johansen',
        'Maria Nilsen', 'Jonas Berg', 'Ingrid Dahl', 'Anders Moen', 'Sofie Haugen']
  </action>
  <verify>
    Run from app/:
    - `flutter analyze` shows no errors in test/helpers/test_data.dart
    - `flutter test` - all existing tests still pass (defaults changed but tests pass explicit values)
    - Verify resetAllTestFactories() calls reset() on ALL factory classes
    - Count factory classes matches count of model classes
  </verify>
  <done>
    Frontend test data factories cover all model classes with realistic Norwegian data. Existing tests pass. resetAllTestFactories() resets all counters. All factories use deterministic UTC timestamps.
  </done>
</task>

</tasks>

<verification>
1. `cd app && flutter pub get` succeeds with equatable
2. `cd app && flutter analyze` shows no new errors (5 pre-existing info-level OK)
3. `cd app && flutter test` - all existing tests pass
4. All 21 frontend model files (non-barrel, non-enum) have `extends Equatable` and `props`
5. test_data.dart contains factories for all model classes with Norwegian names
6. resetAllTestFactories() covers all factory classes
</verification>

<success_criteria>
- All frontend model classes (~64) extend Equatable with complete props lists
- Test data factories expanded from 8 to cover all model entities
- Norwegian names and deterministic timestamps used in all factories
- All existing frontend tests continue to pass
- No changes to existing model behavior (pure additive changes)
</success_criteria>

<output>
After completion, create `.planning/phases/01-test-infrastructure/01-02-SUMMARY.md`
</output>
