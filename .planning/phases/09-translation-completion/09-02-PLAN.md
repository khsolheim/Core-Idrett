---
phase: 09-translation-completion
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - app/pubspec.yaml
  - app/lib/main.dart
autonomous: true

must_haves:
  truths:
    - "System dialogs (DatePicker, TimePicker) display in Norwegian"
    - "MaterialApp is configured with Norwegian locale"
    - "flutter_localizations SDK package is available as dependency"
  artifacts:
    - path: "app/pubspec.yaml"
      provides: "flutter_localizations SDK dependency"
      contains: "flutter_localizations"
    - path: "app/lib/main.dart"
      provides: "Norwegian locale configuration for MaterialApp"
      contains: "GlobalMaterialLocalizations"
  key_links:
    - from: "app/lib/main.dart"
      to: "system dialogs"
      via: "MaterialApp localizationsDelegates"
      pattern: "localizationsDelegates"
    - from: "app/pubspec.yaml"
      to: "app/lib/main.dart"
      via: "flutter_localizations import"
      pattern: "flutter_localizations"
---

<objective>
Configure MaterialApp with Norwegian locale to ensure system-level dialogs (DatePicker, TimePicker, etc.) display in Norwegian.

Purpose: Without locale configuration, Flutter system dialogs default to English regardless of hardcoded UI strings. This ensures the full UI experience is Norwegian (I18N-01 success criteria #4).
Output: MaterialApp configured with nb_NO locale and Flutter localization delegates.
</objective>

<execution_context>
@/Users/karsten/.claude/get-shit-done/workflows/execute-plan.md
@/Users/karsten/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/09-translation-completion/09-RESEARCH.md
@app/lib/main.dart
@app/pubspec.yaml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add flutter_localizations dependency and configure Norwegian locale in MaterialApp</name>
  <files>
    app/pubspec.yaml
    app/lib/main.dart
  </files>
  <action>
**Step 1: Add flutter_localizations to pubspec.yaml**

In `app/pubspec.yaml`, add `flutter_localizations` as an SDK dependency under the `dependencies:` section, right after the `flutter:` SDK entry:

```yaml
dependencies:
  flutter:
    sdk: flutter
  flutter_localizations:
    sdk: flutter
```

This is a Flutter SDK package (not a third-party package), so it uses `sdk: flutter` — no version number needed.

**Step 2: Run flutter pub get**

Run `cd "/Users/karsten/NextCore/Core - Idrett/app" && flutter pub get` to resolve the new dependency.

**Step 3: Configure MaterialApp in main.dart**

Add imports at the top of `app/lib/main.dart`:
```dart
import 'package:flutter_localizations/flutter_localizations.dart';
```

Update the `MaterialApp.router(...)` in `CoreIdrettApp.build()` to add locale configuration. Add these three properties:

```dart
return MaterialApp.router(
  title: 'Core - Idrett',
  debugShowCheckedModeBanner: false,
  theme: AppTheme.lightTheme,
  darkTheme: AppTheme.darkTheme,
  themeMode: themeMode,
  routerConfig: router,
  // Norwegian locale configuration
  locale: const Locale('nb', 'NO'),
  supportedLocales: const [
    Locale('nb', 'NO'),
  ],
  localizationsDelegates: const [
    GlobalMaterialLocalizations.delegate,
    GlobalWidgetsLocalizations.delegate,
    GlobalCupertinoLocalizations.delegate,
  ],
  // Global scaffold messenger key for error display service
  scaffoldMessengerKey: ErrorDisplayService.scaffoldKey,
);
```

The three delegates ensure:
- `GlobalMaterialLocalizations`: Material widgets (DatePicker, TimePicker, dialogs) use Norwegian
- `GlobalWidgetsLocalizations`: Text direction and basic widget localization
- `GlobalCupertinoLocalizations`: iOS-style widgets use Norwegian

Note: The existing `locale: const Locale('nb', 'NO')` in `edit_profile_screen.dart` (line 235) and `locale: 'nb_NO'` in `calendar_screen.dart` (line 117) can remain as-is — they are screen-specific overrides that are now backed by the global configuration.
  </action>
  <verify>
1. Run `cd "/Users/karsten/NextCore/Core - Idrett/app" && flutter pub get` — should succeed without errors
2. Run `cd "/Users/karsten/NextCore/Core - Idrett/app" && flutter analyze` — should show zero new errors (only pre-existing warnings)
3. Verify the imports: `grep -n "flutter_localizations\|GlobalMaterialLocalizations\|GlobalWidgetsLocalizations\|GlobalCupertinoLocalizations" "/Users/karsten/NextCore/Core - Idrett/app/lib/main.dart"` should return import line and delegate lines
4. Verify locale in MaterialApp: `grep -n "locale:\|supportedLocales:\|localizationsDelegates:" "/Users/karsten/NextCore/Core - Idrett/app/lib/main.dart"` should return 3 configuration lines
  </verify>
  <done>flutter_localizations added to pubspec.yaml, MaterialApp configured with locale nb_NO, three GlobalLocalizations delegates registered, flutter analyze passes with no new errors. System dialogs (DatePicker, TimePicker) will now display in Norwegian.</done>
</task>

</tasks>

<verification>
1. `cd "/Users/karsten/NextCore/Core - Idrett/app" && flutter analyze` — zero new errors
2. `grep "flutter_localizations" "/Users/karsten/NextCore/Core - Idrett/app/pubspec.yaml"` — dependency present
3. `grep "GlobalMaterialLocalizations" "/Users/karsten/NextCore/Core - Idrett/app/lib/main.dart"` — delegate configured
4. `grep "locale:" "/Users/karsten/NextCore/Core - Idrett/app/lib/main.dart"` — Norwegian locale set
</verification>

<success_criteria>
- flutter_localizations SDK dependency added to pubspec.yaml
- MaterialApp.router configured with locale: Locale('nb', 'NO')
- Three localization delegates registered (Material, Widgets, Cupertino)
- flutter pub get succeeds
- flutter analyze shows no new errors
- System-level dialogs will render in Norwegian
</success_criteria>

<output>
After completion, create `.planning/phases/09-translation-completion/09-02-SUMMARY.md`
</output>
